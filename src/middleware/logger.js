require('dotenv').config() // This enables us to read from the .env file
const winston = require('winston')

const myFormat = winston.format.combine(
  winston.format.colorize(),
  winston.format.timestamp(),
  winston.format.align(),
  winston.format.printf(info => {
    const { timestamp, level, message, ...args } = info
    const ts = timestamp.slice(0, 19).replace('T', ' ')
    return `${ts} [${level}]: ${message} ${
      Object.keys(args).length ? JSON.stringify(args) : ''
    }`
  })
)

const logger = winston.createLogger({
  level: 'info',
  format: myFormat,
  defaultMeta: { service: 'user-service' }
  // transports: [
  //   // Write all logs with level 'info' and below ('warn' and 'error') to combined.log
  //   //new winston.transports.File({ filename: 'combined.log' })
  // ]
})

if (process.env.NODE_ENV === 'dev' || (process.env.NODE_ENV === 'test')) {
  // Write all logs with level 'info' and below ('warn' and 'error') to the console if we're in dev env
  logger.add(
    new winston.transports.Console()
  )
}

module.exports = logger
