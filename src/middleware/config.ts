import * as express from "express";
import * as bodyParser from "body-parser";
import * as path from "path";
import * as cors from "cors";
import { verifyRestrictedEndpoints } from "./verification";
import { DJIBB_VERSION } from '~shared/constants';


export function configMiddleware(app: express.Application): void {
  app.use(cors());
  app.use(express.static(path.join(__dirname, "..", "..", "..", "public")));
  app.use(bodyParser.json());
  app.use(bodyParser.urlencoded({ extended: false }));
  app.use(verifyRestrictedEndpoints);

  // set response headers with redcat's info
  app.use((req, res, next) => {
    res.set({
      "X-Server": "RedCat",
      "X-Server-Version": DJIBB_VERSION,
      "X-Server-Type": "REST"
    });
    next();
  });
}
