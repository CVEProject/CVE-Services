import { Application } from "express";
import {buildSchema} from 'type-graphql';
import "reflect-metadata";

import * as graphqlHTTP from "express-graphql";
import TestRoutes from "./controllers/test-routes";
// import { schema } from "src/database/graphql/Schema";
// import { root } from "src/database/graphql/Resolver";
import * as expressPlayground from "graphql-playground-middleware-express"
import { User } from '../database/entities/user.entity';
import { RegisterResolver } from '../database/graphql/Resolver';

export async function configureRoutes(app: Application) {
  
  app.use("/api/test", TestRoutes);
  const schema = await buildSchema({
    resolvers: [RegisterResolver],
  });
  // graphql endpoint
  app.use("/graphql", graphqlHTTP(req => ({
    schema: schema,
    graphiql: true,
    context: req
  })));

  if (process.env.NODE_ENV === 'development') {
    app.use("/playground", expressPlayground.default({
      endpoint: '/graphql'
    }));
  }
}
